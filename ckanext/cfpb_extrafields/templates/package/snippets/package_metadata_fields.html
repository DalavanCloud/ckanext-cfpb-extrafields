{% ckan_extends %}
{% import 'macros/form.html' as form %}

{% block custom_fields %}

{#{{ form.markdown('source_names', id='field-source_names', label=_('Source Names'), placeholder=_('e.g., vendor-one'), value=data.source_names, error=errors.source_names) }}#}
{{ form.input('source_names', label=_("Source Names"), placeholder="description of dataset sources", value=data.source_names, error=errors.source_names) }}

<!--access_restrictions -- free form -- permission notes -->
{{ form.markdown('access_restrictions', id='field-access_restrictions', label=_('Access Restrictions'), placeholder=_(''), value=data.access_restrictions, error=errors.access_restrictions) }}
{{ form.input('access_restrictions', label=_("Access Restrictions"), placeholder="", value=data.access_restrictions, error=errors.access_restrictions) }}

<!-- contact_primary -- _name+_email? (two field form) -->
{% call form.input_block("field-constact_primary_name",_("Contact: Primary"), error="") %} {# this is just for clicking #}
    <input id="field-contact_primary_name" type="text" placeholder="enter last name, first name"  value="{{data.contact_primary_name}}" name="contact_primary_name" />
    <input id="field-contact_primary_email" type="email" placeholder="contact@domain.gov" value="{{data.contact_primary_email}}" name="contact_primary_email" />
{% endcall %}



<!-- initial_purpose_for_intake -- markdown free form -->
{{ form.markdown('initial_purpose_for_intake', id='field-initial_purpose_for_intake', label=_('Initial Purpose for Intake'), placeholder=_(''), value=data.initial_purpose_for_intake, error=errors.initial_purpose_for_intake) }}

<!-- legal_authority_for_collection -- pick many ["Market Monitoring", "Supervision", "Enforcement", "Consumer Response"] + OTHER
SHOULD BE f(label,id, h.options_helperfunction [or the returned value])  -->
<div class="control-group ">
    <label class="control-label">Legal Authority for Collection</label>
    <div class="controls ">
	<select id="legal_authority_for_collection" name="legal_authority_for_collection" multiple>
    {# move previously selected elements to the top and select #}
	{% for e in h.clean_select_multi(data.get('legal_authority_for_collection', '')) %}
        {% if e %}
        <option value="{{e}}" selected="selected">{{e}}</option>
	    {% endif %}
    {% endfor %}
    {# provide the default options but don't duplicate if they were selected above #}
	{% for e in h.options_legal_authority_for_collection() %}
        {% if e not in data.get('legal_authority_for_collection', []) %}
            <option value="{{e}}">{{e}}</option>
	    {% endif %}
    {% endfor %}
    {# provide an option for javascript to use to create new fields #}
    <option value="__Other" {% if "__Other" in data.get('legal_authority_for_collection', []) %}selected="selected"{% endif %}>Other (specify then select)</option>
	</select>
    </div>
</div>

{{ form.input('pra_omb_control_number', label=_("PRA: OMB Control Number"), placeholder="####-####", value=data.pra_omb_control_number, error=errors.pra_omb_control_number) }}

<!-- privacy_pia_title -- pick many: list of titles + OTHER -- list on tab titled DIG Lists in xl file  -->
<div class="control-group ">
    <label class="control-label">Privacy: PIA Title</label>
    <div class="controls ">
	<select id="privacy_pia_title" name="privacy_pia_title" multiple>
    {# move previously selected elements to the top and select #}
	{% for e in h.clean_select_multi(data.get('privacy_pia_title', '')) %}
        {% if e %}
        <option value="{{e}}" selected="selected">{{e}}</option>
	    {% endif %}
    {% endfor %}
    {# provide the default options but don't duplicate if they were selected above #}
	{% for e in h.options_privacy_pia_title() %}
        {% if e not in data.get('privacy_pia_title', []) %}
            <option value="{{e}}">{{e}}</option>
	    {% endif %}
    {% endfor %}
    {# provide an option for javascript to use to create new fields #}
    <option value="__Other" {% if "__Other" in data.get('privacy_pia_title', []) %}selected="selected"{% endif %}>Other (specify then select)</option>
	</select>
    </div>
</div>


<!-- privacy_sorn_number -- pick many: CFPB.#### + OTHER -- list in tab (format enforced) -->
<div class="control-group ">
    <label class="control-label">Privacy: SORN number</label>
    <div class="controls ">
    <select id="privacy_sorn_number" name="privacy_sorn_number" multiple>
    {# move previously selected elements to the top and select #}
    {% for e in h.clean_select_multi(data.get('privacy_sorn_number', '')) %}
    {% if e %}
    <option value="{{e}}" selected="selected">{{e}}</option>
        {% endif %}
    {% endfor %}
    {# provide the default options but don't duplicate if they were selected above #}
    {% for e in h.options_privacy_sorn_number() %}
        {% if e not in data.get('privacy_sorn_number', []) %}
            <option value="{{e}}">{{e}}</option>
        {% endif %}
    {% endfor %}
    {# provide an option for javascript to use to create new fields #}
    <option value="__Other" {% if "__Other" in data.get('privacy_sorn_number', []) %}selected="selected"{% endif %}>Other (specify then select)</option>

    </select>
    </div>
</div>

<!-- relevant_governing_documents -- pick many  ["Contract", "MOU", "NDA", "Inter-agency Agreement"] + OTHER -->
<div class="control-group ">
    <label class="control-label">Relevant Governing Documents</label>
    <div class="controls ">
    <select id="relevant_governing_documents" name="relevant_governing_documents" multiple>
    {# move previously selected elements to the top and select #}
    {% for e in h.clean_select_multi(data.get('relevant_governing_documents', '')) %}
    {% if e %}
    <option value="{{e}}" selected="selected">{{e}}</option>
        {% endif %}
    {% endfor %}
    {# provide the default options but don't duplicate if they were selected above #}
    {% for e in h.options_relevant_governing_documents() %}
        {% if e not in data.get('relevant_governing_documents', []) %}
            <option value="{{e}}">{{e}}</option>
        {% endif %}
    {% endfor %}
    </select>
    </div>
</div>

<!-- dig_id -- DI##### -- slug field? -->
{{ form.input('dig_id', label=_("DIG ID"), placeholder="DI#####", value=data.dig_id, error=errors.dig_id) }}

{{ form.markdown('usage_restrictions', id='field-usage_restrictions', 
label=_('Usage Restrictions'), placeholder=_(''), value=data.usage_restrictions, error=errors.usage_restrictions) }}

<!--------------------add-one to pick-1 list --------------------->
<!-- TO DO: add the jquery js to static -->
{# this uses jquery from http://stackoverflow.com/questions/1962041/jquery-dynamically-update-other-option-in-select
#}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script>
$(function() {
    $('select').change( function() { <!--select#type_of_entries-->
        var value = $(this).val();
        if (value == "__Other") {
           var custom = prompt( "Please enter custom value:" );
           if (!custom) return false;
           <!-- clear selections -->
           $(this).find($('option')).attr('selected',false)
           <!-- add and select new option -->
           $(this).prepend('<option value="' + custom + '" selected="selected">' + custom
                             + '</option>');
        }
    });
});
</script>
<hr>
  <div class="control-group ">
    <label class="control-label">Privacy: Has Direct Identifiers</label>
    <div class="controls ">
        <input id="privacy_has_direct_identifiers" type="radio" name="privacy_has_direct_identifiers" value='yes' placeholder="Yes" {% if data.privacy_has_direct_identifiers == 'yes' %}checked{% endif %}>Yes</input>
        <input id="privacy_has_direct_identifiers" type="radio" name="privacy_has_direct_identifiers" value='no' placeholder="No"  {% if data.privacy_has_direct_identifiers != 'yes' %}checked{% endif %}>No</input>
    </div>
  </div>

  <div class="control-group ">
    <label class="control-label">Privacy: Has Privacy Act Statement</label>
    <div class="controls ">
        <input id="privacy_has_privacy_act_statement" type="radio" name="privacy_has_privacy_act_statement" value='yes' placeholder="Yes" {% if data.privacy_has_privacy_act_statement == 'yes' %}checked{% endif %}>Yes</input>
        <input id="privacy_has_privacy_act_statement" type="radio" name="privacy_has_privacy_act_statement" value='no' placeholder="No"  {% if data.privacy_has_privacy_act_statement != 'yes' %}checked{% endif %}>No</input>
    </div>
  </div>

{{ form.input('transfer_initial_size', label=_("Transfer: Initial Size (mb)"), placeholder="eg 1.2", value=data.transfer_initial_size, error=errors.transfer_initial_size) }}

{% endblock %}
